# 预览页面开发文档

## 页面结构

预览页面采用上下分栏布局，主要分为两个部分：

### 1. 上方区域 - iframe预览窗口
- 用于显示AI生成的HTML内容
- 通过iframe安全沙箱模式渲染网页内容
- 支持实时流式内容更新

### 2. 下方区域 - Sender输入框
- 提供用户输入界面
- 支持多行文本输入
- 具备提交和清空功能

## 页面交互流程

### 首次进入页面
1. 页面加载完成后自动调用预览接口
2. 从URL参数或localStorage获取预览数据
3. 如果存在预览数据，立即触发API调用

### 流式数据展示
在接口执行过程中，会显示一个数据流弹窗：

#### 弹窗样式
- **背景色**：黑色背景
- **高度**：固定高度
- **位置**：覆盖在iframe上方

#### 数据流效果
- 类似黑客帝国字母瀑布流效果
- 内容来源：Dify API返回的流式数据
- 展示方式：横向输出，实时更新
- 数据格式：接收到的文本内容逐字显示

#### 流式处理
- 监听Dify API的流式响应事件
- 支持多种事件类型：`text_chunk`、`message`、`workflow_finished`等
- 实时拼接和显示接收到的内容
- 流式结束后自动隐藏弹窗，显示最终生成的HTML内容

### iframe显示机制

#### 首次请求
- iframe在接口完全返回后才显示
- 流式数据在弹窗中展示，不直接更新iframe
- 接口完成后，弹窗消失，iframe显示最终生成的HTML内容

#### 后续请求
- 当前iframe内容保持不变
- 立即显示瀑布流弹窗
- 弹窗中展示新的流式数据
- 接口请求完毕后：
  - 弹窗消失
  - iframe更新为新的HTML内容
